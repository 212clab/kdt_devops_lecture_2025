# 🔍 컨테이너 보안 취약점 스캔 실습 가이드

## 🎯 실습 목표
- Trivy를 사용한 컨테이너 이미지 보안 스캔
- Critical 취약점 발견 및 수정
- 보안 강화된 이미지 구축

## 📋 실습 단계

### 1단계: 취약한 이미지 빌드 및 실행
```bash
# 취약한 이미지 빌드
docker build -f Dockerfile.vulnerable -t vulnerable-web .

# 컨테이너 실행
docker run -d -p 8080:80 --name vulnerable-container vulnerable-web

# 웹사이트 확인
curl http://localhost:8080
```

### 2단계: Trivy로 취약점 스캔
```bash
# Trivy 설치 (Windows)
curl -sfL https://raw.githubusercontent.com/aquasecurity/trivy/main/contrib/install.sh | sh -s -- -b /usr/local/bin

# 이미지 스캔 (전체)
trivy image vulnerable-web

# Critical과 High만 보기
trivy image --severity CRITICAL,HIGH vulnerable-web

# JSON 형태로 출력
trivy image --format json vulnerable-web > scan-results.json
```

### 3단계: 취약점 분석
**예상되는 Critical 취약점:**
- CVE-2019-20372 (Nginx 1.14.0)
- CVE-2021-23017 (Nginx HTTP/2)
- 기타 Debian 패키지 취약점들

### 4단계: 보안 강화된 이미지 빌드
```bash
# 보안 강화된 이미지 빌드
docker build -f Dockerfile.secure -t secure-web .

# 새 컨테이너 실행
docker run -d -p 8081:8080 --name secure-container secure-web

# 웹사이트 확인
curl http://localhost:8081
```

### 5단계: 개선 확인
```bash
# 보안 강화된 이미지 스캔
trivy image secure-web

# 취약점 비교
trivy image --severity CRITICAL,HIGH secure-web
```

## 🎯 성공 기준
- ✅ Critical 취약점: 0개
- ✅ High 취약점: 현저히 감소
- ✅ 비root 사용자로 실행
- ✅ Alpine 베이스 이미지 사용

## 🔧 추가 실습 (고급자)
```bash
# 특정 CVE 검색
trivy image --format table --severity CRITICAL vulnerable-web | grep CVE-2019-20372

# 이미지 히스토리 확인
docker history vulnerable-web
docker history secure-web

# 이미지 크기 비교
docker images | grep -E "(vulnerable-web|secure-web)"
```

## 🚨 주의사항
- 이 실습은 교육 목적으로만 사용하세요
- 실제 프로덕션에서는 절대 취약한 이미지를 사용하지 마세요
- 정기적인 보안 스캔을 CI/CD 파이프라인에 포함시키세요